{"ast":null,"code":"import React,{createContext,useState,useEffect,useContext}from'react';import{authService}from'../services/api';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext(null);export const useAuth=()=>useContext(AuthContext);export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);useEffect(()=>{// Проверяем, есть ли сохраненный пользователь\nconst storedUser=localStorage.getItem('user');const token=localStorage.getItem('token');if(storedUser&&token){setUser(JSON.parse(storedUser));}setLoading(false);},[]);// Загрузка профиля пользователя\nconst loadUserProfile=async()=>{try{setLoading(true);const response=await authService.getProfile();const userData=response.data;setUser(userData);localStorage.setItem('user',JSON.stringify(userData));setError(null);}catch(err){setError('Ошибка загрузки профиля');console.error('Ошибка загрузки профиля:',err);}finally{setLoading(false);}};// Регистрация пользователя\nconst register=async userData=>{try{setLoading(true);await authService.register(userData);setError(null);return true;}catch(err){var _err$response,_err$response$data;setError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||'Ошибка при регистрации');return false;}finally{setLoading(false);}};// Вход пользователя\nconst login=async credentials=>{try{setLoading(true);const response=await authService.login(credentials);const{token,user:userData}=response.data;localStorage.setItem('token',token);localStorage.setItem('user',JSON.stringify(userData));setUser(userData);setError(null);return true;}catch(err){var _err$response2,_err$response2$data;setError(((_err$response2=err.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.message)||'Ошибка при входе');return false;}finally{setLoading(false);}};// Выход пользователя\nconst logout=()=>{localStorage.removeItem('token');localStorage.removeItem('user');setUser(null);};// Обновление профиля\nconst updateProfile=async userData=>{try{setLoading(true);const response=await authService.updateProfile(userData);const updatedUser=response.data.user;setUser(prevUser=>({...prevUser,...updatedUser}));localStorage.setItem('user',JSON.stringify({...user,...updatedUser}));setError(null);return true;}catch(err){var _err$response3,_err$response3$data;setError(((_err$response3=err.response)===null||_err$response3===void 0?void 0:(_err$response3$data=_err$response3.data)===null||_err$response3$data===void 0?void 0:_err$response3$data.message)||'Ошибка при обновлении профиля');return false;}finally{setLoading(false);}};// Изменение пароля\nconst changePassword=async passwords=>{try{setLoading(true);await authService.changePassword(passwords);setError(null);return true;}catch(err){var _err$response4,_err$response4$data;setError(((_err$response4=err.response)===null||_err$response4===void 0?void 0:(_err$response4$data=_err$response4.data)===null||_err$response4$data===void 0?void 0:_err$response4$data.message)||'Ошибка при изменении пароля');return false;}finally{setLoading(false);}};const value={user,loading,error,register,login,logout,updateProfile,changePassword,loadUserProfile};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useState","useEffect","useContext","authService","jsx","_jsx","AuthContext","useAuth","AuthProvider","_ref","children","user","setUser","loading","setLoading","error","setError","storedUser","localStorage","getItem","token","JSON","parse","loadUserProfile","response","getProfile","userData","data","setItem","stringify","err","console","register","_err$response","_err$response$data","message","login","credentials","_err$response2","_err$response2$data","logout","removeItem","updateProfile","updatedUser","prevUser","_err$response3","_err$response3$data","changePassword","passwords","_err$response4","_err$response4$data","value","Provider"],"sources":["/home/falconexlover/desk/lesnoy dvorik/frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect, useContext } from 'react';\nimport { authService } from '../services/api';\n\nconst AuthContext = createContext(null);\n\nexport const useAuth = () => useContext(AuthContext);\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    // Проверяем, есть ли сохраненный пользователь\n    const storedUser = localStorage.getItem('user');\n    const token = localStorage.getItem('token');\n\n    if (storedUser && token) {\n      setUser(JSON.parse(storedUser));\n    }\n    \n    setLoading(false);\n  }, []);\n\n  // Загрузка профиля пользователя\n  const loadUserProfile = async () => {\n    try {\n      setLoading(true);\n      const response = await authService.getProfile();\n      const userData = response.data;\n      \n      setUser(userData);\n      localStorage.setItem('user', JSON.stringify(userData));\n      \n      setError(null);\n    } catch (err) {\n      setError('Ошибка загрузки профиля');\n      console.error('Ошибка загрузки профиля:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Регистрация пользователя\n  const register = async (userData) => {\n    try {\n      setLoading(true);\n      await authService.register(userData);\n      setError(null);\n      return true;\n    } catch (err) {\n      setError(err.response?.data?.message || 'Ошибка при регистрации');\n      return false;\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Вход пользователя\n  const login = async (credentials) => {\n    try {\n      setLoading(true);\n      const response = await authService.login(credentials);\n      const { token, user: userData } = response.data;\n      \n      localStorage.setItem('token', token);\n      localStorage.setItem('user', JSON.stringify(userData));\n      \n      setUser(userData);\n      setError(null);\n      return true;\n    } catch (err) {\n      setError(err.response?.data?.message || 'Ошибка при входе');\n      return false;\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Выход пользователя\n  const logout = () => {\n    localStorage.removeItem('token');\n    localStorage.removeItem('user');\n    setUser(null);\n  };\n\n  // Обновление профиля\n  const updateProfile = async (userData) => {\n    try {\n      setLoading(true);\n      const response = await authService.updateProfile(userData);\n      const updatedUser = response.data.user;\n      \n      setUser(prevUser => ({ ...prevUser, ...updatedUser }));\n      localStorage.setItem('user', JSON.stringify({ ...user, ...updatedUser }));\n      \n      setError(null);\n      return true;\n    } catch (err) {\n      setError(err.response?.data?.message || 'Ошибка при обновлении профиля');\n      return false;\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Изменение пароля\n  const changePassword = async (passwords) => {\n    try {\n      setLoading(true);\n      await authService.changePassword(passwords);\n      setError(null);\n      return true;\n    } catch (err) {\n      setError(err.response?.data?.message || 'Ошибка при изменении пароля');\n      return false;\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const value = {\n    user,\n    loading,\n    error,\n    register,\n    login,\n    logout,\n    updateProfile,\n    changePassword,\n    loadUserProfile\n  };\n\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}